# 1. å®šä¹‰ Service (Java åº”ç”¨çš„å…¥å£)
apiVersion: v1
kind: Service
metadata:
    name: java-app-svc
spec:
    type: LoadBalancer # æš´éœ²åˆ°å®¿ä¸»æœºç«¯å£
    selector:
        app: java-app
    ports:
        - protocol: TCP
          port: 8001 # å¤–éƒ¨è®¿é—®ç«¯å£ (æ¯”å¦‚ http://localhost:8001)
          targetPort: 8001 # å®¹å™¨å†…éƒ¨ç«¯å£

---
# 2. å®šä¹‰ Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
    name: java-app-deploy
spec:
    replicas: 2 # å’±ä»¬ç›´æ¥å¯åŠ¨ 2 ä¸ªå‰¯æœ¬ï¼Œåšè´Ÿè½½å‡è¡¡ï¼
    selector:
        matchLabels:
            app: java-app
    template:
        metadata:
            labels:
                app: java-app
        spec:
            containers:
                - name: java-app
                  image: my-java-app:v1 # âœ… è¿™é‡Œå¡«ä½ åˆšæ‰ tag çš„é•œåƒå
                  imagePullPolicy: Never # âœ… å…³é”®ï¼åªç”¨æœ¬åœ°é•œåƒï¼Œä¸å»ç½‘ä¸Šä¸‹
                  ports:
                      - containerPort: 8001
                      # ğŸ‘‡ğŸ‘‡ğŸ‘‡ æ–°å¢è¿™å— ğŸ‘‡ğŸ‘‡ğŸ‘‡
                  resources:
                      requests:
                          cpu: "100m" # ç”³è¯· 0.1 æ ¸ CPU
                      limits:
                          cpu: "500m" # æœ€å¤šç”¨ 0.5 æ ¸ CPU
                      # ğŸ‘†ğŸ‘†ğŸ‘† æ–°å¢ç»“æŸ ğŸ‘†ğŸ‘†ğŸ‘†
                  # ğŸ‘‡ è¿™é‡Œè¦†ç›–é…ç½®æ–‡ä»¶é‡Œçš„æ•°æ®åº“è¿æ¥
                  env:
                      # 1. MySQL é…ç½®
                      - name: SPRING_DATASOURCE_URL
                        value: "jdbc:mysql://mysql-svc:3306/perftest?useSSL=false&allowPublicKeyRetrieval=true"
                      - name: SPRING_DATASOURCE_USERNAME
                        value: "root"
                      - name: SPRING_DATASOURCE_PASSWORD
                        value: "root"

                      # 2. Redis é…ç½® (Host å¡« Service Name)
                      - name: SPRING_DATA_REDIS_HOST
                        value: "redis-svc"
                      - name: SPRING_DATA_REDIS_PORT
                        value: "6379"

                      # 3. RabbitMQ é…ç½® (Host å¡« Service Name)
                      - name: SPRING_RABBITMQ_HOST
                        value: "rabbitmq-svc"
                      - name: SPRING_RABBITMQ_PORT
                        value: "5672"
                      - name: SPRING_RABBITMQ_USERNAME
                        value: "admin"
                      - name: SPRING_RABBITMQ_PASSWORD
                        value: "admin"
