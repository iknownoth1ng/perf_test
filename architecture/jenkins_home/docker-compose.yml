version: "3.8"

services:
    jenkins:
        # ä½¿ç”¨å¸¦ Blue Ocean æ’ä»¶çš„ç‰ˆæœ¬ï¼Œç•Œé¢æ›´å¥½çœ‹
        # image: jenkinsci/blueocean:latest
        # âœ… æ¢æˆå®˜æ–¹æœ€æ–°çš„ LTS ç‰ˆæœ¬ (JDK 17)
        image: jenkins/jenkins:lts-jdk17
        container_name: my-jenkins
        user: root # âš ï¸ å…³é”®ï¼šä½¿ç”¨ root æƒé™ï¼Œå¦åˆ™åœ¨å®¹å™¨é‡Œæ— æ³•æ“ä½œå®¿ä¸»æœºçš„ Docker
        restart: always
        ports:
            - "8089:8080" # å¤–éƒ¨è®¿é—®ç«¯å£ (é¿å¼€ 8080/8088)
            - "50000:50000"
        environment:
            # - JAVA_OPTS=-Djenkins.install.runSetupWizard=false # è·³è¿‡åˆå§‹è®¾ç½®å‘å¯¼
            - JAVA_OPTS=-Dhudson.model.DirectoryBrowserSupport.CSP="" # è§£å†³ CSP å®‰å…¨ç­–ç•¥é—®é¢˜ï¼ˆHTML æŠ¥å‘Šæ˜¾ç¤ºä¸å…¨çš„é€šç—…ï¼‰
        volumes:
            - ../../data/jenkins_data:/var/jenkins_home # æ•°æ®æŒä¹…åŒ–
            # ğŸ”¥ æ ¸å¿ƒé­”æ³•ï¼šæŠŠå®¿ä¸»æœºçš„ Docker é‡Œçš„ socket æŒ‚è½½è¿›å»
            # è¿™æ · Jenkins å®¹å™¨é‡Œæ•² docker å‘½ä»¤ï¼Œå®é™…æ˜¯åœ¨æ“ä½œ B æœºå®¿ä¸»æœº
            - /var/run/docker.sock:/var/run/docker.sock
        networks:
            - global-monitor-net

volumes:
    jenkins_data:

networks:
    global-monitor-net:
        external: true
